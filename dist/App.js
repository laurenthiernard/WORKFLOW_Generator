import e,{useState as i,useRef as C}from"../web_modules/react.js";import"./App.css.proxy.js";import M from"./components/WorlkflowInterface.js";import x from"./components/WorlkflowEditor.js";import L from"./components/ConfirmationModal.js";import H from"./components/EditStepModal.js";import G from"./components/EditStepItemModal.js";import z from"./WorkflowContext.js";import p from"../web_modules/react-spinners/SquareLoader.js";import J from"../web_modules/react-json-view.js";import{FontAwesomeIcon as Q}from"../web_modules/@fortawesome/react-fontawesome.js";import{faAngleUp as V,faAngleDown as K}from"../web_modules/@fortawesome/free-solid-svg-icons.js";function X({}){const[t,_]=i(),[v,E]=i(!1),[m,P]=i(!1),[S,d]=i(!1),[F,u]=i(null),[W,w]=i(null),R=C(null),f=C(null);function A(o){_(void 0),o!==void 0&&E(!0),setTimeout(()=>{_(o),E(!1)},400)}function h(o){o.preventDefault(),P(!m)}function k(o){switch(o.target.id){case"templateName":_({...t,Title:o.target.value});break;case"wfNote":_({...t,Message:o.target.value});break;default:break}}const I=o=>["InitiatorOptionsStart","IsAutoEscalated","IsSkipStepAllowed","IsDelegationAllowed","StepsDelegationOfAuthorityDependant"].includes(o);function s(o){const{id:l,name:a,value:r,type:n,checked:c}=o.target;I(a)?(console.log("ðŸš€ changeCheckboxHandler: ",a,c),_({...t,[a]:c})):(console.log("ðŸš€ changeRadioHandler: ",a,r),_({...t,[a]:r}))}function N(o){console.log("addStep at:",o);const l=[...t.WorkFlowTemplateSteps];l.map((a,r)=>({...a,StepNumber:r>=o?++a.StepNumber:a.StepNumber})),l.push(B(++o)),_({...t,WorkFlowTemplateSteps:l})}async function g(o){console.log("----> removeStep: ",o),d(!0);try{let l=await new Promise((r,n)=>{R.current=r,f.current=n});d(!1);const a=[...t.WorkFlowTemplateSteps].filter(r=>r.StepNumber!==o);a.map((r,n)=>({...r,StepNumber:++n>=o?--r.StepNumber:r.StepNumber})),_({...t,WorkFlowTemplateSteps:a})}catch(l){console.log("----> cancel",l),d(!1)}}function b(o,l){console.log("----> removeStepItem: ",o,l);const a=[...t.WorkFlowTemplateSteps[o-1].WorkFlowTemplateStepItems].filter(n=>n.ItemOrder!==l);a.map((n,c)=>({...n,StepNumber:++c>=l?--n.ItemOrder:n.ItemOrder}));const r=[...t.WorkFlowTemplateSteps];r[o-1].WorkFlowTemplateStepItems=a,_({...t,WorkFlowTemplateSteps:r})}function T(o){const l=[...t.WorkFlowTemplateSteps];l[o-1].WorkFlowTemplateStepItems.push(U(l[o-1].WorkFlowTemplateStepItems.length+1)),_({...t,WorkFlowTemplateSteps:l})}function O(o,l,a){const r=[...t.WorkFlowTemplateSteps];r[o-1].WorkFlowTemplateStepItems[l-1]=a,_({...t,WorkFlowTemplateSteps:r})}function y(o,l){console.log("----> step: ",o,l);const a=[...t.WorkFlowTemplateSteps];a[o-1]=l,_({...t,WorkFlowTemplateSteps:a})}function D(o,l){const a=t?.WorkFlowTemplateSteps.filter(r=>r.StepNumber===o)[0];u(e.createElement(H,{stepJson:a,onUpdate:r=>y(o,r),viewportPosition:l,onClose:()=>u(null)}))}function j(o,l,a){const r=t?.WorkFlowTemplateSteps.filter(n=>n.StepNumber===o)[0].WorkFlowTemplateStepItems[l-1];w(e.createElement(G,{stepItemJson:r,onUpdate:n=>O(o,l,n),viewportPosition:a,onClose:()=>w(null)}))}const B=o=>({WorkFlowTemplateGUID:t?.GUID,StepNumber:o,StepDurationDays:1,StepReminderDays:1,WorkFlowStepRequiredApprovalCode:"",Title:"New Step",IsInactive:!1,IsDeleted:!1,RowVersion:"AAAAAAAQLJw=",WorkFlowTemplateStepItems:[U(1)]}),U=o=>({WorkFlowTemplateGUID:t?.GUID,Title:"New StepItem",ItemOrder:o,IsInactive:!1,IsDeleted:!1,RowVersion:"AAAAAAAQLKE=",WorkFlowTemplateStepItemUsers:[],WorkFlowTemplateStepItemMemberPositionRoles:[]}),q=m&&e.createElement("div",{className:"form"},e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Workflow Title:"),e.createElement("div",{className:"forms"},e.createElement("input",{type:"text",name:"templateName",id:"templateName",value:t?.Title,onChange:k}))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Workflow Message",e.createElement("br",null),"(Sent to Users):Â "),e.createElement("div",{className:"forms"},e.createElement("textarea",{name:"wfNote",id:"wfNote",cols:60,rows:8,value:t?.Message,onChange:k}))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Workflow Outcome Decided By:"),e.createElement("div",{className:"forms",onChange:s},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowOutcomeDecidedByCode",id:"WorkFlowOutcomeDecidedByCodeA",value:"A",defaultChecked:t?.WorkFlowOutcomeDecidedByCode==="A"}),e.createElement("label",{htmlFor:"WorkFlowOutcomeDecidedByCodeA"},"Final step outcome")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowOutcomeDecidedByCode",id:"WorkFlowOutcomeDecidedByCodeB",value:"B",defaultChecked:t?.WorkFlowOutcomeDecidedByCode==="B"}),e.createElement("label",{htmlFor:"WorkFlowOutcomeDecidedByCodeB"},"Lowest of all step outcomes")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Step Approvals Required:"),e.createElement("div",{className:"forms",onChange:s},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowStepRequiredApprovalCode",id:"WorkFlowStepRequiredApprovalCodeA",value:"A",defaultChecked:t?.WorkFlowStepRequiredApprovalCode==="A"}),e.createElement("label",{htmlFor:"WorkFlowStepRequiredApprovalCodeA"},"All step items completed")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowStepRequiredApprovalCode",id:"WorkFlowStepRequiredApprovalCodeB",value:"B",defaultChecked:t?.WorkFlowStepRequiredApprovalCode==="B"}),e.createElement("label",{htmlFor:"WorkFlowStepRequiredApprovalCodeB"},"Any step item completed")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowStepRequiredApprovalCode",id:"WorkFlowStepRequiredApprovalCodeC",value:"C",defaultChecked:t?.WorkFlowStepRequiredApprovalCode==="C"}),e.createElement("label",{htmlFor:"WorkFlowStepRequiredApprovalCodeC"},"All step items unless rejected")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Initiator Options-Start:"),e.createElement("div",{className:"forms",onChange:s},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"checkbox",name:"InitiatorOptionsStart",id:"InitiatorOptionsStart",defaultChecked:t?.InitiatorOptionsStart===!0}),e.createElement("label",{htmlFor:"InitiatorOptionsStart"},"When starting a workflow: Initiator can edit step durations, roles and participants")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Initiator Options-During:"),e.createElement("div",{className:"forms",onChange:s},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowInitiatorOptionsCode",id:"WorkFlowInitiatorOptionsCodeA",value:"A",defaultChecked:t?.WorkFlowInitiatorOptionsCode==="A"}),e.createElement("label",{htmlFor:"WorkFlowInitiatorOptionsCodeA"},"While workflow in progress Initiator can edit step participants")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowInitiatorOptionsCode",id:"WorkFlowInitiatorOptionsCodeB",value:"B",defaultChecked:t?.WorkFlowInitiatorOptionsCode==="B"}),e.createElement("label",{htmlFor:"WorkFlowInitiatorOptionsCodeB"},"While workflow in progress Initiator can skip steps")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowInitiatorOptionsCode",id:"WorkFlowInitiatorOptionsCodeC",value:"C",defaultChecked:t?.WorkFlowInitiatorOptionsCode==="C"}),e.createElement("label",{htmlFor:"WorkFlowInitiatorOptionsCodeC"},"No Options")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowInitiatorOptionsCode",id:"WorkFlowInitiatorOptionsCodeD",value:"D",defaultChecked:t?.WorkFlowInitiatorOptionsCode==="D"}),e.createElement("label",{htmlFor:"WorkFlowInitiatorOptionsCodeD"},"Initiator Can Stop Workflow")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"On Rejection:"),e.createElement("div",{className:"forms",onChange:s},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowRejectionActionCode",id:"WorkFlowRejectionActionCodeA",value:"A",defaultChecked:t?.WorkFlowRejectionActionCode==="A"}),e.createElement("label",{htmlFor:"WorkFlowRejectionActionCodeA"},"Continue to next step")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowRejectionActionCode",id:"WorkFlowRejectionActionCodeB",value:"B",defaultChecked:t?.WorkFlowRejectionActionCode==="B"}),e.createElement("label",{htmlFor:"WorkFlowRejectionActionCodeB"},"Back to workflow intiator")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowRejectionActionCode",id:"WorkFlowRejectionActionCodeC",value:"C",defaultChecked:t?.WorkFlowRejectionActionCode==="C"}),e.createElement("label",{htmlFor:"WorkFlowRejectionActionCodeC"},"Reset and send back to previous step")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Is Auto Escalated:"),e.createElement("div",{className:"forms",onChange:s},e.createElement("div",null,e.createElement("input",{type:"checkbox",name:"IsAutoEscalated",id:"IsAutoEscalated",defaultChecked:t?.IsAutoEscalated===!0})))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Is Skip Step Allowed:"),e.createElement("div",{className:"forms",onChange:s},e.createElement("div",null,e.createElement("input",{type:"checkbox",name:"IsSkipStepAllowed",id:"IsSkipStepAllowed",defaultChecked:t?.IsSkipStepAllowed===!0})))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Is Delegation Allowed:"),e.createElement("div",{className:"forms",onChange:s},e.createElement("div",null,e.createElement("input",{type:"checkbox",name:"IsDelegationAllowed",id:"IsDelegationAllowed",defaultChecked:t?.IsDelegationAllowed===!0})))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Steps DOA Dependant:"),e.createElement("div",{className:"forms",onChange:s},e.createElement("div",null,e.createElement("input",{type:"checkbox",name:"StepsDelegationOfAuthorityDependant",id:"StepsDelegationOfAuthorityDependant",defaultChecked:t?.StepsDelegationOfAuthorityDependant===!0})))));return e.createElement(z.Provider,{value:{addStep:N,removeStep:g,addStepItem:T,removeStepItem:b,editStep:D,editStepItem:j,currentWorkflow:t}},e.createElement("div",{className:"App"},e.createElement("header",{className:"App-header"},e.createElement(M,{onChangeTemplate:A})),e.createElement("main",{className:"App-main"},t!==void 0&&e.createElement("p",null,e.createElement("a",{href:"#",onClick:h},e.createElement(Q,{icon:m?K:V,className:"link-icon"}),m?"hide":"show"," config")),v?e.createElement("div",{className:"pageSpinners"},e.createElement(p,{size:10,color:"#EEE"}),e.createElement(p,{size:10,color:"#EEE"}),e.createElement(p,{size:10,color:"#EEE"})):q,e.createElement(x,{steps:t}),t!==void 0&&e.createElement(J,{src:t,theme:"monokai",displayDataTypes:!1,iconStyle:"square",enableClipboard:!1})),S&&e.createElement(L,{resolver:R.current,rejecter:f.current}),F,W))}export default X;
