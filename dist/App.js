import.meta.env={"MODE":"dev","NODE_ENV":"dev"};import e,{useState as m,useRef as U}from"../web_modules/react.js";import"./App.css.proxy.js";import K from"./components/WorlkflowInterface.js";import Z from"./components/WorlkflowEditor.js";import X from"./components/ConfirmationModal.js";import $ from"./components/EditStepModal.js";import ee from"./components/EditStepItemModal.js";import te from"./WorkflowContext.js";import E from"../web_modules/react-spinners/SquareLoader.js";import oe from"../web_modules/react-json-view.js";import{FontAwesomeIcon as ae}from"../web_modules/@fortawesome/react-fontawesome.js";import{faAngleUp as le,faAngleDown as re}from"../web_modules/@fortawesome/free-solid-svg-icons.js";import{v4 as ne}from"../web_modules/uuid.js";function se({}){const[u,P]=m(!1),[t,s]=m(),[W,w]=m(!1),[c,F]=m(!1),[d,A]=m(window.SelectedProject),[b,p]=m(!1),[h,k]=m(null),[T,f]=m(null),R=U(null),S=U(null),[I,N]=m([]),[g,D]=m([]),O=import.meta.env.MODE==="production"?{env:"prod",url:"/api/",token:"",templatesStem:"WorkFlowTemplate/Templates",templateSaveStem:"WorkFlowTemplate",templateStem:"WorkFlowTemplate/Template",projectsStem:"Project/Load",doaStem:"WorkFlowDelegationOfAuthority/Load",contactStem:`ProjectContact/DetailedContactByProject?RootProjectId=${d}`}:{env:"dev",url:"https://api-uat.extrack.com/",token:"_INRjoSjhNjX_GCDckkcISWb7OOG68SgAEJzeQFGqReEWDBNdz6eLCqP_Y7q5dXDNq07vJtBHKtsDQ2ZzO9SSrHIcHxcMKwp5kTz18lucEvYTqGtDDYkCTLMf5sLRupZbnGcG8vHn1_G0SFp2NFx0PdR_Q5Ne_79U_wUU8v_rG58JcG7OqDH0VQJu9G0_fMB4I2JVomWKW85-NQe5qHQPu9TGyHoCSs80UijedKU2y9jR448_X2ZGLMt2giEHwT5VIgkrvwbc7S8caQbMehflYCWBDb7SsMhQFd_emVNlNPMwiDAEaEWDAYkOcbWwrr_gTdZb5gNbv2bVK2xIw3R0N0-1z1m2qFASjj0W-gukvXUKZ4QB7ckzkWc_v0zE8-euJufDmY0PqI_eE-AzG3mP4jhO98VjEPpZG8aRWpXoJcTHv170cZgFLQrrmlzXFui6jBJbC5170bw3mUR2pGedkOhrstfvOEfjA-ObWRTbx5DcKVP4439yheEHC2pCgmnAQsr5hdpN25p5rU4H09whhw3VvceRosGzmybqhzHHybBsiQspW3cQSXiJHbCaQTBoiSaMvvZ5EvR1m5ZdYW5FC8YJTM2THGKHba_mnCbEipw1G_W4rs3ieHYTMvscukKKYsWKAwXMgwz2xCLcfHegn-lz_C6JB7R1Z4p2LVFuo5k7VOJqmfyXnJ5gYbXrOcfzc1iUgoR37Z09SOOWqFE8PFyGg16lpbvgXPhTNr1ljOUYfoJToWdhdnjFj_G9mhiU5Q_CkS51lcqpYAlGBNUozoatOXTKDlSTjbdFHb0NwGm59gEtnbZ3ewoAYULhBbfs4YXjk7B2sbD3PJ1rnciLyFZIYAg0xLPv_iVdnTTG8Cm3fZvztCCiDLUdw0sihIBcuSLB9ODsMN-HWFnZ-5n-uLjJFD-qSj5vF0M7ejqXPO0QTWbA8umP_r7EAyJ6j-___aB3mCRlrwlHG9pHrnb45TGu1NcKADYBZCJdNVv5vWaNgurVrh9yWFpWwxtDM2tuoEFJ1OxWSwxLsw0nmCPmdF9uD8CZzt4vwfnK5SSdqY4YrMTDae9YomKQQX5Yztxl7m6opdOG0O-ndufNVA1xsaIB0aw1p0LGN_nj2lfRK3rnvsJaTfmnvmKmWOyFi9i",templatesStem:"V1.0/WorkFlow/Templates",templateSaveStem:"V1.0/WorkFlow/Template",templateStem:"V1.0/Workflow/Template",projectsStem:"V1.0/Project",doaStem:"V1.0/WorkFlow/DelegationOfAuthority",contactStem:`V1.0/Project/${d}/Directory/Contacts`};function j(o){s(void 0),o!==void 0&&w(!0),setTimeout(()=>{console.log("---> changeTemplateHandler:: Set template: ",o),s(o),w(!1)},400)}function y(o){o.preventDefault(),F(!c)}function v(o){switch(o.target.id){case"templateName":s({...t,Title:o.target.value});break;case"wfNote":s({...t,Message:o.target.value});break;default:break}}const B=o=>["InitiatorOptionsStart","IsAutoEscalated","IsSkipStepAllowed","IsDelegationAllowed","StepsDelegationOfAuthorityDependant"].includes(o);function _(o){const{id:a,name:l,value:r,type:n,checked:i}=o.target;B(l)?(console.log("ðŸš€ changeCheckboxHandler: ",l,i),s({...t,[l]:i})):(console.log("ðŸš€ changeRadioHandler: ",l,r),s({...t,[l]:r}))}function L(o){console.log("addStep at:",o,"currentWorkflow: ",t.WorkFlowTemplateSteps);const a=[...t.WorkFlowTemplateSteps];a.map((l,r)=>({...l,StepNumber:r>=o?++l.StepNumber:l.StepNumber})),a.push(z(++o)),console.log("----> templateStepsToUpdate: ",a),s({...t,WorkFlowTemplateSteps:a})}async function q(o){console.log("----> removeStep: ",o),p(!0);try{let a=await new Promise((n,i)=>{R.current=n,S.current=i});p(!1);const l=[...t.WorkFlowTemplateSteps].filter(n=>n.StepNumber===o)[0];l.IsDeleted=!0,l.StepNumber=100;const r=[...t.WorkFlowTemplateSteps].filter(n=>n.StepNumber!==-1);r.map((n,i)=>({...n,StepNumber:++i>=o?--n.StepNumber:n.StepNumber})),s({...t,WorkFlowTemplateSteps:r})}catch(a){p(!1)}}function G(o,a){console.log("----> removeStepItem: ",o,a);const l=[...t.WorkFlowTemplateSteps[o-1].WorkFlowTemplateStepItems].filter(n=>n.ItemOrder!==a);l.map((n,i)=>({...n,StepNumber:++i>=a?--n.ItemOrder:n.ItemOrder}));const r=[...t.WorkFlowTemplateSteps];r[o-1].WorkFlowTemplateStepItems=l,s({...t,WorkFlowTemplateSteps:r})}function M(o){const a=[...t.WorkFlowTemplateSteps];a[o-1].WorkFlowTemplateStepItems.push(C(a[o-1].WorkFlowTemplateStepItems.length+1)),s({...t,WorkFlowTemplateSteps:a})}function x(o,a,l){const r=[...t.WorkFlowTemplateSteps];r[o-1].WorkFlowTemplateStepItems[a-1]=l,s({...t,WorkFlowTemplateSteps:r})}function H(o,a){const l=[...t.WorkFlowTemplateSteps].map((r,n)=>({...r,IsDraft:r.StepNumber>o&&!a.IsDraft?!1:r.IsDraft}));l[o-1]=a,s({...t,WorkFlowTemplateSteps:l})}function J(o,a){const l=t?.WorkFlowTemplateSteps.filter(r=>r.StepNumber===o)[0];k(e.createElement($,{stepJson:l,onUpdate:r=>H(o,r),viewportPosition:a,onClose:()=>k(null)}))}function V(o,a,l){const r=t?.WorkFlowTemplateSteps.filter(n=>n.StepNumber===o)[0].WorkFlowTemplateStepItems[a-1];f(e.createElement(ee,{stepItemJson:r,onUpdate:n=>x(o,a,n),viewportPosition:l,onClose:()=>f(null)}))}const z=o=>({GUID:ne(),WorkFlowTemplateGUID:t?.GUID,StepNumber:o,StepDurationDays:1,StepReminderDays:1,WorkFlowStepRequiredApprovalCode:"A",Title:"New Step",IsInactive:!1,IsDeleted:!1,RowVersion:"AAAAAAAQLJw=",WorkFlowTemplateStepItems:[C(1)]}),C=o=>({WorkFlowTemplateGUID:t?.GUID,Title:"New StepItem",ItemOrder:o,IsInactive:!1,IsDeleted:!1,RowVersion:"AAAAAAAQLKE=",WorkFlowTemplateStepItemUsers:[],WorkFlowTemplateStepItemMemberPositionRoles:[]}),Y=c&&e.createElement("div",{className:"form"},e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Workflow Title:"),e.createElement("div",{className:"forms"},e.createElement("input",{type:"text",name:"templateName",id:"templateName",value:t?.Title,onChange:v,disabled:t?.TemplateLocked}))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Steps DOA Dependant:"),e.createElement("div",{className:"forms",onChange:_},e.createElement("div",null,e.createElement("input",{type:"checkbox",name:"StepsDelegationOfAuthorityDependant",id:"StepsDelegationOfAuthorityDependant",defaultChecked:t?.StepsDelegationOfAuthorityDependant===!0,disabled:!0})))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Workflow Message",e.createElement("br",null),"(Sent to Users):Â "),e.createElement("div",{className:"forms"},e.createElement("textarea",{name:"wfNote",id:"wfNote",cols:60,rows:8,value:t?.Message,onChange:v,disabled:t?.TemplateLocked}))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Workflow Outcome Decided By:"),e.createElement("div",{className:"forms",onChange:_},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowOutcomeDecidedByCode",id:"WorkFlowOutcomeDecidedByCodeA",value:"A",defaultChecked:t?.WorkFlowOutcomeDecidedByCode==="A",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowOutcomeDecidedByCodeA"},"Final step outcome")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowOutcomeDecidedByCode",id:"WorkFlowOutcomeDecidedByCodeB",value:"B",defaultChecked:t?.WorkFlowOutcomeDecidedByCode==="B",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowOutcomeDecidedByCodeB"},"Lowest of all step outcomes")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Step Approvals Required:"),e.createElement("div",{className:"forms",onChange:_},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowStepRequiredApprovalCode",id:"WorkFlowStepRequiredApprovalCodeA",value:"A",defaultChecked:t?.WorkFlowStepRequiredApprovalCode==="A",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowStepRequiredApprovalCodeA"},"All step items completed")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowStepRequiredApprovalCode",id:"WorkFlowStepRequiredApprovalCodeB",value:"B",defaultChecked:t?.WorkFlowStepRequiredApprovalCode==="B",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowStepRequiredApprovalCodeB"},"Any step item completed")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowStepRequiredApprovalCode",id:"WorkFlowStepRequiredApprovalCodeC",value:"C",defaultChecked:t?.WorkFlowStepRequiredApprovalCode==="C",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowStepRequiredApprovalCodeC"},"All step items unless rejected")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Initiator Options-Start:"),e.createElement("div",{className:"forms",onChange:_},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"checkbox",name:"InitiatorOptionsStart",id:"InitiatorOptionsStart",defaultChecked:t?.InitiatorOptionsStart===!0,disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"InitiatorOptionsStart"},"When starting a workflow: Initiator can edit step durations, roles and participants")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Initiator Options-During:"),e.createElement("div",{className:"forms",onChange:_},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowInitiatorOptionsCode",id:"WorkFlowInitiatorOptionsCodeA",value:"A",defaultChecked:t?.WorkFlowInitiatorOptionsCode==="A",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowInitiatorOptionsCodeA"},"While workflow in progress Initiator can edit step participants")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowInitiatorOptionsCode",id:"WorkFlowInitiatorOptionsCodeB",value:"B",defaultChecked:t?.WorkFlowInitiatorOptionsCode==="B",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowInitiatorOptionsCodeB"},"While workflow in progress Initiator can skip steps")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowInitiatorOptionsCode",id:"WorkFlowInitiatorOptionsCodeC",value:"C",defaultChecked:t?.WorkFlowInitiatorOptionsCode==="C",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowInitiatorOptionsCodeC"},"No Options")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowInitiatorOptionsCode",id:"WorkFlowInitiatorOptionsCodeD",value:"D",defaultChecked:t?.WorkFlowInitiatorOptionsCode==="D",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowInitiatorOptionsCodeD"},"Initiator Can Stop Workflow")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"On Rejection:"),e.createElement("div",{className:"forms",onChange:_},e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowRejectionActionCode",id:"WorkFlowRejectionActionCodeA",value:"A",defaultChecked:t?.WorkFlowRejectionActionCode==="A",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowRejectionActionCodeA"},"Continue to next step")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowRejectionActionCode",id:"WorkFlowRejectionActionCodeB",value:"B",defaultChecked:t?.WorkFlowRejectionActionCode==="B",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowRejectionActionCodeB"},"Back to workflow intiator")),e.createElement("div",{className:"forms-row"},e.createElement("input",{type:"radio",name:"WorkFlowRejectionActionCode",id:"WorkFlowRejectionActionCodeC",value:"C",defaultChecked:t?.WorkFlowRejectionActionCode==="C",disabled:t?.TemplateLocked}),e.createElement("label",{htmlFor:"WorkFlowRejectionActionCodeC"},"Reset and send back to previous step")))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Is Auto Escalated:"),e.createElement("div",{className:"forms",onChange:_},e.createElement("div",null,e.createElement("input",{type:"checkbox",name:"IsAutoEscalated",id:"IsAutoEscalated",defaultChecked:t?.IsAutoEscalated===!0,disabled:t?.TemplateLocked})))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Is Skip Step Allowed:"),e.createElement("div",{className:"forms",onChange:_},e.createElement("div",null,e.createElement("input",{type:"checkbox",name:"IsSkipStepAllowed",id:"IsSkipStepAllowed",defaultChecked:t?.IsSkipStepAllowed===!0,disabled:t?.TemplateLocked})))),e.createElement("div",{className:"controls"},e.createElement("div",{className:"labels"},"Is Delegation Allowed:"),e.createElement("div",{className:"forms",onChange:_},e.createElement("div",null,e.createElement("input",{type:"checkbox",name:"IsDelegationAllowed",id:"IsDelegationAllowed",defaultChecked:t?.IsDelegationAllowed===!0,disabled:t?.TemplateLocked})))));return e.createElement(te.Provider,{value:{addStep:L,removeStep:q,addStepItem:M,removeStepItem:G,editStep:J,editStepItem:V,apiConfig:O,currentWorkflow:t,doa:I,setDoa:N,contacts:g,setContacts:D,currentProjectId:d,setCurrentProjectId:A,showJson:u,setShowJson:P}},e.createElement("div",{className:"App"},e.createElement("header",{className:"App-header"},e.createElement(K,{onChangeTemplate:j})),e.createElement("main",{className:"App-main"},t!==void 0&&e.createElement("p",null,e.createElement("a",{href:"#",onClick:y},e.createElement(ae,{icon:c?re:le,className:"link-icon"}),c?"hide":"show"," config")),W?e.createElement("div",{className:"pageSpinners"},e.createElement(E,{size:10,color:"#EEE"}),e.createElement(E,{size:10,color:"#EEE"}),e.createElement(E,{size:10,color:"#EEE"})):Y,e.createElement(Z,{steps:t}),t!==void 0&&u&&e.createElement(oe,{src:t.WorkFlowTemplateSteps,theme:"monokai",displayDataTypes:!1,iconStyle:"square",enableClipboard:!1,collapsed:2})),b&&e.createElement(X,{resolver:R.current,rejecter:S.current}),h,T))}export default se;
