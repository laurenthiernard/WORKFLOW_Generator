import t,{useState as c,useContext as L}from"../../web_modules/react.js";import I from"./SelectSearchable.js";import T from"../WorkflowContext.js";import a from"./EditStepItemModal.module.css.proxy.js";export default function j({viewportPosition:U,onUpdate:P,onClose:p,stepItemJson:C,stepItemJson:{Title:N,WorkFlowTemplateStepItemMemberPositionRoles:m,WorkFlowTemplateStepItemUsers:u}}){const M=m[0]?[{label:m[0].MemberPositionRoleName,MemberPositionRoleGUID:m[0].MemberPositionRoleGUID}]:[],[i,f]=c(N),[s,R]=c(M),[b,D]=c(u.filter(e=>e.IsInactive===!1)),[_,S]=c(u.filter(e=>e.IsCC===!0)),n=L(T),d=n?.currentWorkflow?.StepsDelegationOfAuthorityDependant,r=n?.currentWorkflow?.TemplateLocked,w=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function h(e){switch(e.target.id){case"title":f(e.target.value);break;case"role":R(e.target.value);break;case"rules":const E=e.target.selectedIndex;default:break}}function k(e){let E=b.map(l=>{const o=_.some(F=>l.UserGUID===F.UserGUID);return{...l,IsCC:o,IsInactive:!1}});const $=_.filter(l=>!E.map(o=>o.UserGUID).includes(l.UserGUID)).map(l=>({...l,IsCC:!0,IsInactive:!0})),g=[...E,...$].map(l=>{const o={...l};return delete o.label,o}),x=s[0]?[{MemberPositionRoleName:s[0].label,MemberPositionRoleGUID:s[0].MemberPositionRoleGUID}]:[],y=d?{...C,Title:i,WorkFlowTemplateStepItemMemberPositionRoles:x}:{...C,Title:i,WorkFlowTemplateStepItemUsers:g};P(y),p()}function G(e){p()}return t.createElement(t.Fragment,null,t.createElement("div",{className:a.backdrop,onClick:G}),t.createElement("div",{className:a.EditStepItemModal_Container,style:{left:U.x,top:U.y}},t.createElement("div",{className:a.EditStepItemModal_Header},t.createElement("h1",null,"Edit Step Item")),t.createElement("div",{className:a.EditStepItemModal_Content},t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Title"),t.createElement("input",{type:"text",name:"title",id:"title",className:a.title,value:i,onChange:h,disabled:r})),d&&t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Role"),t.createElement(I,{items:n?.doa.map(e=>({label:`${e.MemberPositionRoleName} | [${e.DelegatedValue?w.format(e.DelegatedValue).replace(/\D00(?=\D*$)/,""):"undefined"}]`,MemberPositionRoleName:e.MemberPositionRoleName,MemberPositionRoleGUID:e.MemberPositionRoleGUID})),selectedItems:[...s],allowMultiple:!1,width:"l",onSelectItem:e=>R(e),disabled:r})),!d&&t.createElement(t.Fragment,null,t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Particpants"),t.createElement(I,{items:n?.contacts.map(e=>({label:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,ContactName:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,UserGUID:e.User.GUID})),allowMultiple:!0,width:"l",deleteMode:"keep",selectedItems:[...b].filter(e=>!e.IsDeleted===!0).map(e=>({...e,label:e.ContactName})),onSelectItem:e=>D(e),disabled:r})),t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Cc"),t.createElement(I,{items:n?.contacts.map(e=>({label:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,ContactName:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,UserGUID:e.User.GUID})),allowMultiple:!0,width:"l",selectedItems:[..._].map(e=>({...e,label:e.ContactName,ContactName:e.ContactName})),onSelectItem:e=>S(e),disabled:r})))),t.createElement("div",{className:a.EditStepItemModal_Footer},t.createElement("button",{className:`btn ${a.EditStepItemModal_btnOK}`,onClick:k},"OK"))))}
