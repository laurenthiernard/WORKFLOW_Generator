import t,{useState as m,useContext as F}from"../../web_modules/react.js";import d from"./SelectSearchable.js";import L from"../WorkflowContext.js";import a from"./EditStepItemModal.module.css.proxy.js";export default function T({viewportPosition:E,onUpdate:P,onClose:U,stepItemJson:p,stepItemJson:{Title:b,WorkFlowTemplateStepItemMemberPositionRoles:I,WorkFlowTemplateStepItemUsers:C}}){const N=I[0]?[{label:I[0].MemberPositionRoleName}]:[],[r,M]=m(b),[n,R]=m(N),[u,S]=m(C.filter(e=>e.IsInactive===!1)),[c,f]=m(C.filter(e=>e.IsCC===!0)),s=F(L),_=s?.currentWorkflow?.StepsDelegationOfAuthorityDependant,D=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function w(e){switch(e.target.id){case"title":M(e.target.value);break;case"role":R(e.target.value);break;case"rules":const i=e.target.selectedIndex;default:break}}function h(e){let i=u.map(l=>{const o=c.some(y=>l.UserGUID===y.UserGUID);return{...l,IsCC:o}});const $=c.filter(l=>!i.map(o=>o.UserGUID).includes(l.UserGUID)).map(l=>({...l,IsCC:!0,IsInactive:!0})),g=[...i,...$].map(l=>{const o={...l};return delete o.label,o}),k=n[0]?[{MemberPositionRoleName:n[0].MemberPositionRoleName,MemberPositionRoleGUID:n[0].MemberPositionRoleGUID}]:[],x=_?{...p,Title:r,WorkFlowTemplateStepItemMemberPositionRoles:k}:{...p,Title:r,WorkFlowTemplateStepItemUsers:g};P(x),U()}function G(e){U()}return t.createElement(t.Fragment,null,t.createElement("div",{className:a.backdrop,onClick:G}),t.createElement("div",{className:a.EditStepItemModal_Container,style:{left:E.x,top:E.y}},t.createElement("div",{className:a.EditStepItemModal_Header},t.createElement("h1",null,"Edit Step Item")),t.createElement("div",{className:a.EditStepItemModal_Content},t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Title"),t.createElement("input",{type:"text",name:"title",id:"title",className:a.title,value:r,onChange:w})),_&&t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Role"),t.createElement(d,{items:s?.doa.map(e=>({label:`${e.MemberPositionRoleName} | [${e.DelegatedValue?D.format(e.DelegatedValue).replace(/\D00(?=\D*$)/,""):"undefined"}]`,MemberPositionRoleName:e.MemberPositionRoleName,MemberPositionRoleGUID:e.MemberPositionRoleGUID})),selectedItems:[...n],allowMultiple:!1,width:"l",onSelectItem:e=>R(e)})),!_&&t.createElement(t.Fragment,null,t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Particpants"),t.createElement(d,{items:s?.contacts.map(e=>({label:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,ContactName:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,UserGUID:e.User.GUID})),allowMultiple:!0,width:"l",selectedItems:[...u].map(e=>({...e,label:e.ContactName})),onSelectItem:e=>S(e)})),t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Cc"),t.createElement(d,{items:s?.contacts.map(e=>({label:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,ContactName:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,UserGUID:e.User.GUID})),allowMultiple:!0,width:"l",selectedItems:[...c].map(e=>({...e,label:e.ContactName})),onSelectItem:e=>f(e)})))),t.createElement("div",{className:a.EditStepItemModal_Footer},t.createElement("button",{className:`btn ${a.EditStepItemModal_btnOK}`,onClick:h},"OK"))))}
