import t,{useState as r,useContext as F}from"../../web_modules/react.js";import E from"./SelectSearchable.js";import L from"../WorkflowContext.js";import a from"./EditStepItemModal.module.css.proxy.js";export default function T({viewportPosition:I,onUpdate:P,onClose:U,stepItemJson:p,stepItemJson:{Title:b,WorkFlowTemplateStepItemMemberPositionRoles:m,WorkFlowTemplateStepItemUsers:C}}){const N=m[0]?[{label:m[0].MemberPositionRoleName,MemberPositionRoleGUID:m[0].MemberPositionRoleGUID}]:[],[c,M]=r(b),[o,u]=r(N),[R,f]=r(C.filter(e=>e.IsInactive===!1)),[_,D]=r(C.filter(e=>e.IsCC===!0)),s=F(L),i=s?.currentWorkflow?.StepsDelegationOfAuthorityDependant,S=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});function w(e){switch(e.target.id){case"title":M(e.target.value);break;case"role":u(e.target.value);break;case"rules":const d=e.target.selectedIndex;default:break}}function h(e){let d=R.map(l=>{const n=_.some(y=>l.UserGUID===y.UserGUID);return{...l,IsCC:n,IsInactive:!1}});const $=_.filter(l=>!d.map(n=>n.UserGUID).includes(l.UserGUID)).map(l=>({...l,IsCC:!0,IsInactive:!0})),g=[...d,...$].map(l=>{const n={...l};return delete n.label,n}),k=o[0]?[{MemberPositionRoleName:o[0].label,MemberPositionRoleGUID:o[0].MemberPositionRoleGUID}]:[],x=i?{...p,Title:c,WorkFlowTemplateStepItemMemberPositionRoles:k}:{...p,Title:c,WorkFlowTemplateStepItemUsers:g};P(x),U()}function G(e){U()}return t.createElement(t.Fragment,null,t.createElement("div",{className:a.backdrop,onClick:G}),t.createElement("div",{className:a.EditStepItemModal_Container,style:{left:I.x,top:I.y}},t.createElement("div",{className:a.EditStepItemModal_Header},t.createElement("h1",null,"Edit Step Item")),t.createElement("div",{className:a.EditStepItemModal_Content},t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Title"),t.createElement("input",{type:"text",name:"title",id:"title",className:a.title,value:c,onChange:w})),i&&t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Role"),t.createElement(E,{items:s?.doa.map(e=>({label:`${e.MemberPositionRoleName} | [${e.DelegatedValue?S.format(e.DelegatedValue).replace(/\D00(?=\D*$)/,""):"undefined"}]`,MemberPositionRoleName:e.MemberPositionRoleName,MemberPositionRoleGUID:e.MemberPositionRoleGUID})),selectedItems:[...o],allowMultiple:!1,width:"l",onSelectItem:e=>u(e)})),!i&&t.createElement(t.Fragment,null,t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Particpants"),t.createElement(E,{items:s?.contacts.map(e=>({label:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,ContactName:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,UserGUID:e.User.GUID})),allowMultiple:!0,width:"l",deleteMode:"keep",selectedItems:[...R].filter(e=>!e.IsDeleted===!0).map(e=>({...e,label:e.ContactName})),onSelectItem:e=>f(e)})),t.createElement("div",{className:a.EditStepItemModal_Content_Row},t.createElement("h3",null,"Cc"),t.createElement(E,{items:s?.contacts.map(e=>({label:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,ContactName:`${e.Contact.NameFirst} ${e.Contact.NameLast}`,UserGUID:e.User.GUID})),allowMultiple:!0,width:"l",selectedItems:[..._].map(e=>({...e,label:e.ContactName,ContactName:e.ContactName})),onSelectItem:e=>D(e)})))),t.createElement("div",{className:a.EditStepItemModal_Footer},t.createElement("button",{className:`btn ${a.EditStepItemModal_btnOK}`,onClick:h},"OK"))))}
